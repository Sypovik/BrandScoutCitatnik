# Цитатник — REST API на Go

Это простой REST API-сервис для управления цитатами, реализованный на Go с использованием только стандартных библиотек. Проект разработан в соответствии с принципами слоистой архитектуры и демонстрирует применение dependency injection, интерфейсного программирования и потокобезопасного in-memory хранилища.

## Возможности

Сервис позволяет:

* добавлять новые цитаты,
* получать список всех цитат,
* получать случайную цитату,
* фильтровать цитаты по автору,
* удалять цитаты по идентификатору.

## Структура проекта

```
.
├── cmd/
│   └── server/
│       └── main.go          # Точка входа приложения
├── internal/
│   ├── handlers/            # HTTP-обработчики и тесты к ним
│   ├── models/              # Модель данных "цитата"
│   ├── repository/          # Интерфейс репозитория, in-memory реализация и тесты
│   └── router/              # Настройка маршрутов и тесты
├── makefile                 # Сценарии сборки, тестирования и запуска
├── go.mod                   # Модуль Go
└── README.md                # Документация
```

## Запуск проекта

Для запуска требуется установленный [Go](https://go.dev/doc/install).

**Через Makefile**:

```bash
make run            # Сборка и запуск (порт по умолчанию: 8080)
```
---

```bash
make run PORT=8081  # Запуск на указанном порту
```

```bash
make build          # Только сборка бинарника
```
```bash
make start          # Запуск уже собранного сервера
```
```bash
make start PORT=8081
```

**Вручную без Makefile**:

```bash
go run cmd/server/main.go         # Запуск на порту 8080
```
---
```bash

go run cmd/server/main.go 8081   # Запуск на указанном порту
```

## API

**POST /quotes** — добавление цитаты

```bash
curl -X POST http://localhost:8080/quotes \
  -H "Content-Type: application/json" \
  -d '{"author":"Confucius", "quote":"Life is simple, but we insist on making it complicated."}'
```

**GET /quotes** — получить все цитаты

```bash
curl http://localhost:8080/quotes
```

**GET /quotes/random** — случайная цитата

```bash
curl http://localhost:8080/quotes/random
```

**GET /quotes?author=Имя** — фильтрация по автору

```bash
curl http://localhost:8080/quotes?author=Confucius
```

**DELETE /quotes/{id}** — удалить цитату по ID

```bash
curl -X DELETE http://localhost:8080/quotes/1
```

## Тестирование

**С помощью Makefile**:

```bash
make test_all             # Все тесты
make coverage_all         # Покрытие тестами
```
---
```bash

make test_repository      # Только репозиторий
make coverage_repository  # Покрытие репозитория
make test_handler         # Только обработчики
make coverage_handler     # Покрытие обработчиков
make coverage_router      # Покрытие маршрутов
```

**Без Makefile**:

```bash
go test -v ./internal/...                                 # Все тесты

go test -v -coverprofile=coverage.out ./internal/...
go tool cover -html=coverage.out                         # HTML отчет покрытия
```

## Дополнительные команды

```bash
make fmt     # Форматирование кода
make clear   # Очистка артефактов сборки
```

## Возможные улучшения

Сервис можно расширить по нескольким направлениям.  
На уровне middleware полезно реализовать поддержку CORS, логирование входящих HTTP-запросов и ограничение частоты обращений. Для повышения устойчивости можно организовать хранение данных не только в оперативной памяти, но и во внешних источниках — например, JSON-файлах, базах данных вроде PostgreSQL или SQLite, либо использовать Redis для кеширования. Поскольку доступ к данным осуществляется через абстрактный интерфейс, реализация может быть заменена без влияния на остальной код.

Также стоит выделить отдельный сервисный слой между обработчиками и хранилищем. Это позволит централизовать валидацию входных данных, проверку бизнес-правил и прочую прикладную логику. В части инфраструктуры можно внедрить контейнеризацию с помощью Docker, наладить CI/CD для автоматизации тестирования и сборки, а конфигурационные параметры выносить в .env-файл или YAML-конфигурацию.
## Технические детали

* Язык: Go 1.22.2
* Зависимости: только стандартная библиотека
* Хранилище: потокобезопасное in-memory хранилище с использованием sync.Mutex
* Порт: 8080 по умолчанию, можно изменить через переменную окружения или аргумент
